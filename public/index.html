<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Car Control</title>
  <style>
    .control { display: inline-block; width: 50px; height: 50px; background: #ddd; margin: 5px; }
    .d-pad { display: flex; flex-wrap: wrap; width: 120px; }
    .d-pad a { text-align: center; line-height: 50px; font-size: 24px; }
    .parent { text-align: center; }
    .wrapper { margin-bottom: 20px; }
    .speed-settings { font-size: 20px; margin-bottom: 10px; }
    .option { display: inline-block; margin: 5px; cursor: pointer; }
  </style>
</head>
<body>
  <div class="parent">
    <div class="speed-settings">Speed Settings</div>
    <div class="wrapper">
      <input type="radio" name="speed-settings" id="option-1" value="slow">
      <input type="radio" name="speed-settings" id="option-2" value="normal">
      <input type="radio" name="speed-settings" id="option-3" value="fast">
      <label for="option-1" class="option option-1">
        <div class="dot"></div>
        <span>Slow</span>
      </label>
      <label for="option-2" class="option option-2">
        <div class="dot"></div>
        <span>Normal</span>
      </label>
      <label for="option-3" class="option option-3">
        <div class="dot"></div>
        <span>Fast</span>
      </label>
    </div>

    <div class="set blue">
      <nav class="d-pad">
        <a class="up control" data-direction="up">↑</a>
        <a class="right control" data-direction="right">→</a>
        <a class="down control" data-direction="down">↓</a>
        <a class="left control" data-direction="left">←</a>
      </nav>
    </div>
  </div>

  <script>
    // Create a WebSocket connection to the server
    const socket = new WebSocket('ws://localhost:8080'); // Change 'localhost' to your server IP if needed

    // Handle WebSocket connection open
    socket.onopen = function() {
      console.log('WebSocket connection established');
    };

    // Handle WebSocket messages from the server
    socket.onmessage = function(event) {
      console.log('Message from server:', event.data);
    };

    // Handle WebSocket errors
    socket.onerror = function(error) {
      console.error('WebSocket Error: ' + error);
    };

    // Send commands on control button clicks
    document.querySelectorAll('.control').forEach((item) => {
      item.addEventListener('touchstart', function(event) {
        const direction = event.target.dataset.direction;
        socket.send(direction);  // Send direction command to server
      });

      item.addEventListener('touchend', function(event) {
        socket.send('stop');  // Send stop command when touch ends
      });
    });

    // Handle speed setting changes
    document.querySelectorAll('input[type=radio][name="speed-settings"]').forEach((radio) => {
      radio.addEventListener('change', () => {
        const speed = radio.value;
        socket.send(`speed:${speed}`);  // Send speed setting to server
      });
    });
    // Prevent scrolling on every click!

// super sweet vanilla JS delegated event handling!
document.body.addEventListener("click", function (e) {
  if (e.target && e.target.nodeName == "A") {
    e.preventDefault();
  }
});

function touchStartHandler(event) {
  console.log(event.target.dataset.direction);
  console.log("Touch Start!");
  // alert("Click!")
}

function touchEndHandler(event) {
  console.log(event.target.name);
  console.log("Touch End!");
  // alert("Click!")
}

document.querySelectorAll(".control").forEach((item) => {
  item.addEventListener("touchstart", touchStartHandler);
});

document.querySelectorAll(".control").forEach((item) => {
  item.addEventListener("touchend", touchEndHandler);
});

var speedSettings = document.querySelectorAll(
  'input[type=radio][name="speed-settings"]'
);
speedSettings.forEach((radio) =>
  radio.addEventListener("change", () => alert(radio.value))
);

  </script>
</body>
</html>
